# TargetBulkUpload
Bulk upload of metadata to TaRGET II DCC

## Install python3

## Prepare library (if necessary)
```
pip3 install xlrd
```

## Description
This script can be used to upload metadata to the TaRGET II DCC metadata database from a specific Excel template. 
You can use it to:
1. Upload new metedata to the database;
2. Update existing records in the database;
3. Establish relationships between metadata records.

## How to use it

### Obtain your personal API key.
* Visit http://target.wustl.edu:8002/login.
* Log in with your user name and password.
* Click "Show API key".
* Copy your API key string.
	
### If you want to upload new data to the metadata database
1. Fill in the Excel template accordingly. You must use the template in the repo. Don't rename the template; if you have to rename it, keep the version number intact in the name.
	* Leave the "System Accession" column blank for the records you want to upload. If system accession is found in a row, that row will be skipped. However, the System Accession - User Accession association will still be established. 
		* For example, if you have a mouse record in the excel with system accession "TRGTMSE0001" and user accession "USRMSE0001", the mouse record itself will not be uploaded. However, If you have a biosample extracted from the mouse, either "TRGTMSE0001" or "USRMSE0001" works if you want to link that biosample record to this mouse.
	* "User Accession" can be used to establish relationships with other records in the same Excel file. Please fill in "User Accession" according to our accession rules (see "Instructions" tab and individual tab headers).
	* "User Accessions" submitted by the same user must be unique. So not only they must be unique in a single excel file, They cannot be reused for different batch of upload.
	* You can leave "User Accession" blank if you don't need to establish any relationship to that record.
	* All the dates in the Excel can be a date type in Excel format or a string in format "YYYY-MM-DD". Don't worry if Excel changes the date format automatically (it means Excel knows it is a date).
	* The relationship columns are labeled with a different color on the right side in each sheet. It should be either a "User Accession" in the same Excel file or an existing "System Accession" in the database.
2. Run it with following command in test mode:
```
python3 submission.py -k <API key> -x <excel file>
```
3. If there is no error during the test run, you can upload the same Excel file to the production database with the following command (please don't use the following command and contact us if there is any unexpected warning or error):
```
python3 submission.py -k <API key> -x <excel file> --notest
```

### If you want to update existing records in the metadata database
1. Fill in the Excel template accordingly. You must use the template in the repo. Don't rename the template; if you have to rename it, keep the version number intact in the name.
	* To update data in the database, fill in all the applicable columns along with the "System Accession" generated by the database.
	* All the dates in the Excel can be a date type in Excel format or a string in format "YYYY-MM-DD". Don't worry if Excel changes the date format automatically (it means Excel knows it is a date).
	* The relationship columns are labeled with a different color on the right side in each sheet. During update, only other record's "System Accession" should be used to establish relationships.
2. Run it with following command in test mode:
```
python3 submission.py -k <API key> -x <excel file> -m update
```
3. If there is no error during the test run, you can update the same Excel file to the production database with the following command (please don't use the following command and contact us if there is any unexpected warning or error):
```
python3 submission.py -k <API key> -x <excel file> -m update --notest
```
